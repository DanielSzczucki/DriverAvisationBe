import { DriverRecord } from "../record/driver.record";
import { pool } from "../utils/db";
import { ValidationError } from "../utils/errors";

afterAll(async () => {
  await pool.end();
});

test("Uninserted LoadRecord should have no id", async () => {
  const driver = new DriverRecord({
    referenceNumber: "RUS-1212-234",
    name: "Dan",
    lastName: "Tona",
    phoneNumber: 48798787765,
    truckNumber: "NO4608Y",
    trailerNumber: "WGM56987",
    companyName: "ASAP",
    loadingUnloading: "unloading",
    loadId: "3456789876gshdnu857k45jhw4",
  });

  expect(driver.id).toBeUndefined();
});

test("Inserted DriverRecord shoud have id and this id id uuid", async () => {
  const driver = new DriverRecord({
    name: "Dan",
    lastName: "Tona",
    phoneNumber: 48798787765,
    truckNumber: "NO4608Y",
    trailerNumber: "WGM56987",
    companyName: "ASAP",
    loadingUnloading: "unloading",
    loadId: "3456789876gshdnu857k467895jhw4",
  });

  await driver.insert();

  expect(driver.id).toBeDefined();
  expect(driver.id).toMatch(
    /^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/
  );

  await driver.delete();
});

test("Throw?", async () => {
  const driver = new DriverRecord({
    id: "dfghju7654ewedfghnjuyh",
    referenceNumber: "RUS-1212-234",
    name: "Dan",
    lastName: "Tona",
    phoneNumber: 48798787765,
    truckNumber: "NO4608Y",
    trailerNumber: "WGM56987",
    companyName: "ASAP",
    loadingUnloading: "unloading",
    loadId: "3456789876gshdnu857k45jhw4",
  });

  await driver.insert();

  expect(driver.name.length <= 3).toThrow();

  await driver.delete();
});
